<!doctype html>

<html>
    <head>
        <title>cas test</title>
        <link rel="stylesheet" type="text/css" href="style.css" />
        <script src="cas.js" language="JavaScript"></script>
    </head>
    <body>
        <input id="i" size="100" type="text" /><br />
        <div id="m">Loading...</div>
        <ol id="res"></ol>
        <script language="JavaScript">
            (function () {
                var inp = document.getElementById("i");
                var mess = document.getElementById("m");
                var grammar = new CAS.Grammar();
                grammar.literal("number",
                    /-?\d+(?:\.\d+)?(?:E-?\d+)?/,
                    function(v) {
                        var n = Number(v);
                        if (isNaN(n))
                            throw new Error("not a number");
                        return n;
                    });
                grammar.token("variable", /[a-zA-Z][a-zA-Z0-9]*/).nud = function(parser) {
                    return this.value;
                };
                grammar.prefix("(", function(parser) {
                    var expr = parser.expression(0);
                    parser.advance(")");
                    return expr;
                });
                grammar.infixl('+', 50);
                grammar.infixl('-', 50);
                grammar.infixl('*', 60);
                grammar.infixl('/', 60);
                var results = document.getElementById("res");
                function result(content) {
                    if (typeof content == "string") {
                        content = document.createTextNode(content);
                        content = document.createElement("li").appendChild(content);
                        content = content.parentNode;
                    }
                    results.insertBefore(content, results.firstChild);
                }
                inp.addEventListener('keypress', function(e) {
                    if (e.keyIdentifier != "Enter") return;
                    mess.innerText = "Parsing...";
                    try {
                        result(JSON.stringify(grammar.parse(inp.value)));
                        mess.innerText = "";
                    } catch(err) {
                        switch (err.name) {
                        case "CAS.ParseError":
                            mess.innerText = "Error: " + err.message;
                            inp.setSelectionRange(err.start, err.end);
                            break;
                        default:
                            throw err;
                        }
                    }
                    inp.focus();
                });
                mess.innerText = "";
                inp.focus();
            })();
        </script>
    </body>
</html>
